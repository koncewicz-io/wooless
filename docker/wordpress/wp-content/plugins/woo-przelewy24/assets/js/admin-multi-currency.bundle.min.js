!function(){"use strict";window.przelewy24Multicurrency={init(){this.attachRowActions(),this.attachListeners()},selectors:{form:document.getElementById("p24_currency_form"),dialog:document.getElementById("p24_currency_dialog"),currencyName:document.getElementById("p24_currency_name"),addButton:document.getElementById("p24_add_currency"),currencyButtons:document.querySelectorAll(".p24-ui-currency[data-currency]"),currencyDropdown:document.getElementById("p24_currency_code_select"),currencyCodeHiddenField:document.getElementById("p24_currency_code"),merchantIdTextField:document.getElementById("p24_currency_merchant_id"),crcKeyTextField:document.getElementById("p24_currency_crc_key"),reportsKeyTextField:document.getElementById("p24_currency_reports_key"),multiplierTextField:document.getElementById("p24_currency_multiplier"),formCurrencyCode:document.getElementById("p24_form_currency_code"),formCurrencySymbol:document.getElementById("p24_form_currency_symbol"),formCurrencyName:document.getElementById("p24_form_currency_name"),saveButton:document.getElementById("p24_save_currency"),cancelButton:document.getElementById("p24_cancel_currency"),editCurrencyButtons:document.querySelectorAll("[data-currency-edit]"),deleteCurrencyButtons:document.querySelectorAll("[data-currency-delete]")},selectedCurrency:null,showForm(){const{dialog:e,currencyCodeHiddenField:r,formCurrencySymbol:t,formCurrencyName:c,formCurrencyCode:n}=this.selectors;if(!this.selectedCurrency)return;r.value=this.selectedCurrency;const{symbol:o,name:s}=p24CurrencySettings[this.selectedCurrency];c.innerHTML=s,n.innerHTML=this.selectedCurrency,t.innerHTML=o,e&&e.showModal()},hideForm(){const{dialog:e}=this.selectors;e&&e.close()},clearForm(){const{form:e}=this.selectors;e.reset(),this.selectedCurrency=null},attachListeners(){const{form:e,dialog:r,currencyButtons:t,currencyDropdown:c,addButton:n,cancelButton:o}=this.selectors;r&&r.addEventListener("close",(()=>{this.clearForm()})),e&&e.addEventListener("submit",(e=>{e.preventDefault(),this.saveCurrency()})),o&&o.addEventListener("click",(()=>{this.hideForm()})),c&&jQuery(c).on("select2:select",(()=>{n.disabled=!c.value})),t.length&&t.forEach((e=>e.addEventListener("click",(r=>{r.preventDefault(),this.selectedCurrency=e.dataset.currency,this.showForm()})))),n&&n.addEventListener("click",(()=>{this.selectedCurrency=c.value,this.showForm()}))},prepareEditForm(e){const{merchant_id:r,crc_key:t,reports_key:c,multiplier:n}=e,{merchantIdTextField:o,shopIdTextField:s,crcKeyTextField:d,reportsKeyTextField:l,multiplierTextField:u}=this.selectors;o.value=r,d.value=t,l.value=c,u.value=n},attachRowActions(){const{editCurrencyButtons:e,deleteCurrencyButtons:r}=this.selectors;e.length&&[...e].forEach((e=>e.addEventListener("click",(()=>{try{const r=JSON.parse(e.closest("td").dataset.config);this.prepareEditForm(r),this.selectedCurrency=r.currency_code,this.showForm()}catch(e){console.log(e)}})))),r.length&&[...r].forEach((e=>e.addEventListener("click",(()=>{try{const r=JSON.parse(e.closest("td").dataset.config),{i18n:t}=wp;confirm(t.__("Are you sure you want to remove this configuration","woocommerce-p24"))&&this.removeCurrency(r.currency_code)}catch(e){console.log(e)}}))))},saveCurrency(){const{form:e}=this.selectors,r={save_currency_nonce:przelewy24MulticurrencyData.saveCurrencyNonce};for(let[t,c]of new FormData(e).entries())r[t]=c;wp.ajax.post("save_currency",r).done((()=>location.reload())).fail((e=>{this.showError(e?.responseJSON?.data?.message)})).always()},removeCurrency(e){const r={currency_code:e,remove_currency_nonce:przelewy24MulticurrencyData.removeCurrencyNonce};wp.ajax.post("remove_currency",r).done((()=>location.reload())).fail((e=>{this.showError(e?.responseJSON?.data?.message)})).always()},showError(e){const{data:r,i18n:t}=wp;e=e||t.__("Some error occured","woocommerce-p24"),r.dispatch("core/notices").createErrorNotice(e,{type:"default",isDismissible:!0})}},document.addEventListener("DOMContentLoaded",(()=>{window.przelewy24Multicurrency.init()}))}();
