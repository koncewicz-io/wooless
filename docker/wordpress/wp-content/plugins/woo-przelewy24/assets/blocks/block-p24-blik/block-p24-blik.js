(()=>{"use strict";const e=window.wp.htmlEntities,t=window.React,s=window.wp.i18n,i=window.ReactJSXRuntime,{CheckboxControl:r}=window.wc.blocksCheckout,n=t=>{const{description:s}=t;return(0,e.decodeEntities)(s||"")},o=e=>{let{src:t,name:s=""}=e.icon;return"string"==typeof e.icon&&(t=e.icon),(0,i.jsx)("img",{style:{maxHeight:"20px"},src:t,title:s,alt:s,loading:"lazy"})},c=e=>{const{icons:t,additional:r}=e;return t.length?(0,i.jsxs)("span",{style:{display:"flex",flexWrap:"wrap",gap:"6px",fontSize:"65%",alignItems:"center",justifyContent:"flex-end"},children:[t.map((({src:e,name:t},s)=>(0,i.jsx)(o,{icon:{src:e,name:t}},s))),r?(0,i.jsx)("span",{style:{lineHeight:"1.2"},children:(0,s.sprintf)((0,s.__)("+%d other methods","woocommerce-p24"),r)}):""]}):""},a=({required:e=!1,label:t,checked:s,onChange:n,...o})=>(0,i.jsx)(r,{required:e,label:(0,i.jsx)("span",{dangerouslySetInnerHTML:{__html:t}}),checked:s,onChange:n,...o,__nextHasNoMarginBottom:!0}),l=e=>{const{PaymentMethodLabel:t}=e.components,{label:s,icon:r,icons:n,additional:a}=e;return(0,i.jsxs)("span",{style:{width:"100%",display:"flex",gap:"12px",justifyContent:"space-between",alignItems:"center"},children:[(0,i.jsx)(t,{text:s}),n?(0,i.jsx)(c,{icons:n,additional:a}):"",r?(0,i.jsx)(o,{icon:r}):""]})};class h{constructor(){this.reset(),this.debug=!1,this.regulation=!1,this.checkout="block"}setError(e){this.error=!0,this.errorMessage=e,this.debug&&console.log("Error:",e)}setCheckout(e){this.checkout=e}hasError(){return this.error}getError(){return this.errorMessage}reset(){this.error=!1,this.errorMessage=null}setRegulation(e){this.regulation=!!e}}const{registerPaymentMethod:u}=window.wc.wcBlocksRegistry,{getSetting:d}=window.wc.wcSettings,{TextInput:m,ValidationInputError:g,CheckboxControl:p}=window.wc.blocksCheckout,{Spinner:k,Button:x}=window.wc.blocksComponents,C=d("p24-blik_data",{}),b=(0,e.decodeEntities)(C.title),f=C?.i18n||{},S=new class extends h{constructor(e){super();const{url:t,refreshTime:s=1e3,totalWaitTime:i=45e3,i18n:r,orderId:n=null,orderKey:o=null,debug:c=!1}=e;this.debug=c,this.url=t,this.refreshTime=s,this.totalWaitTime=i,this.currentWaitingTime=0,this.i18n=r||{},this.orderId=n,this.orderKey=o,this.abort=!0,this.timer=null,this.timeout=null,this.oneClick=!1,this.saveOneClick=!1,this.code=""}setCode(e){this.code=e}format(e){return(e=e.replace(/\D/g,"")).length>=4&&(e=e.replace(/^(.{3})/g,"$1 ")),e.slice(0,7)}setOneClick(e){this.oneClick=e||!1}setSaveOneClick(e){this.saveOneClick=e}codeValidation(e){return 6===(e||this.code).replace(/\D/g,"").length}longPooling(){this.currentWaitingTime=0;const e=new Promise(((e,t)=>{this.resolve=e,this.reject=t}));return this.abort=!1,this.checkStatus(!0),e}wait(){return this.timer=this.totalWaitTime/1e3,new Promise((e=>{this.timeout=setTimeout(e,this.refreshTime)}))}async checkStatus(e=!1){const{error:t}=this.i18n;e||(this.currentWaitingTime+=this.refreshTime,this.timer--);const s={type:"get-order-status",checkout:this.checkout};this.orderId&&(s.orderId=this.orderId),this.orderKey&&(s.orderKey=this.orderKey);let i=await fetch(this.url,{method:"POST",body:JSON.stringify(s)});if(200===i.status)try{if(i=await i.json(),i?.data?.completed)this.resolve({success:!0,redirect:i?.data?.redirect});else if(this.currentWaitingTime<this.totalWaitTime){if(this.abort)return;await this.wait(),await this.checkStatus()}else this.currentWaitingTime>=this.totalWaitTime?this.resolve({error:!0,message:t.timeout}):this.resolve({error:!0,message:t.unexpected})}catch(e){this.resolve({error:!0,message:t.unexpected})}else this.reject({error:!0,message:t.unexpected})}cleanup(){const{error:e}=this.i18n;clearTimeout(this.timeout),this.timer=null,this.oneClick=!1,this.saveOneClick=!1,this.code="",this.timeout=null,this.abort=!0,this.resolve&&this.resolve({error:!0,message:e.aborted})}getPaymentData(){let e="code";return this.oneClick&&(e="one-click"),{type:e,regulation:this.regulation,checkout:this.checkout,code:this.code.replace(/\D/g,""),oneClick:!!this.oneClick&&this.oneClick.toString(),save:this.saveOneClick}}}(C),j=()=>{const[e,s]=(0,t.useState)(S.currentWaitingTime);return(0,t.useEffect)((()=>{const e=setInterval((()=>{s(S.currentWaitingTime),S.currentWaitingTime>=S.totalWaitTime&&clearInterval(e)}),1e3);return()=>clearInterval(e)}),[]),(0,i.jsx)("div",{children:(0,i.jsx)("strong",{children:(0,i.jsxs)("big",{children:["00:",((S.totalWaitTime-e)/1e3).toString().padStart(2,0)]})})})},w=e=>{const{onChange:t,options:s,value:r}=e;return s.length?(0,i.jsxs)("div",{className:"p24-1clicks",children:[(0,i.jsx)("div",{className:"p24-1clicks__label",children:f.use_saved}),(0,i.jsx)("div",{className:"p24-1clicks__items",children:s.map(((e,s)=>{let n="p24-1click p24-1click--blik";return r===e.id&&(n+=" p24-1click--active"),(0,i.jsxs)("button",{className:n,type:"button",onClick:()=>{return s=e.id,void t(r===s?"":s);var s},children:[e?.logo&&(0,i.jsx)("figure",{className:"p24-1click__logo p24-1click--blik__logo",children:(0,i.jsx)("img",{src:e.logo.url,alt:e.logo.alt})}),(0,i.jsx)("span",{className:"p24-1click--blik__name",children:e.name}),(0,i.jsx)("span",{className:"p24-1click--blik__valid",children:e.valid_to})]},s)}))}),(0,i.jsx)("div",{className:"p24-1clicks__or",children:f.or})]}):""},y=({eventRegistration:e,emitResponse:s})=>{const{responseTypes:r,noticeContexts:o}=s,{onPaymentSetup:c,onCheckoutSuccess:l,onCheckoutFail:h}=e,[u,d]=(0,t.useState)(!1),[x,b]=(0,t.useState)(""),[y,v]=(0,t.useState)(0),[E,T]=(0,t.useState)(!1),[R,_]=(0,t.useState)(""),[N,O]=(0,t.useState)(""),[W,I,M,P]=function(e,s){const[i,r]=(0,t.useState)(""),[n,o]=(0,t.useState)(!1),[c,a]=(0,t.useState)(!1),[l,h]=(0,t.useState)(!0);return(0,t.useEffect)((()=>{c&&r(l&&!n?s:"")}),[n,l,c]),[n,i,t=>{c||a(!0),e&&e.setRegulation(t),o(t)},(e=!0)=>{let t=!1;return e&&!n?(r(s),t=!1):(e&&n||!e)&&(r(""),t=!0),t},e=>{e||r(""),h(e)}]}(S,f.error.rules),D=(0,t.useRef)(null),B=e=>{e=S.format(e),b(e),S.codeValidation(e)?O(""):O(f.error.validation)};return(0,t.useEffect)((()=>()=>{S.cleanup()}),[]),(0,t.useEffect)((()=>{D?.current?.focus()}),[]),(0,t.useEffect)((()=>{const e=c((()=>{const e={type:r.ERROR};return P()?(O(""),R||S.codeValidation(x)?(e.type=r.SUCCESS,e.meta={paymentMethodData:{...S.getPaymentData(),type:R?"one-click":"code",oneclick:String(R||""),code:String(x||""),save:!!u,regulation:!!W}}):O(f.error.validation),e):e}));return()=>{e()}}),[r.ERROR,r.SUCCESS,c,x,u,E,R,W,I]),(0,t.useEffect)((()=>{S.setCode(x)}),[x]),(0,t.useEffect)((()=>{S.setSaveOneClick(u)}),[u]),(0,t.useEffect)((()=>{S.setOneClick(!!R),R&&d(!1)}),[R]),(0,t.useEffect)((()=>{const e=l((async({processingResponse:e})=>{const{error:t}=e?.paymentDetails||{};t||v(1);let{success:s,error:i,message:n,redirect:c}=t?{error:!0,message:t}:await S.longPooling(),a={type:r.ERROR};return i&&n&&(v(0),a.message=n,a.messageContext=o.PAYMENTS),s&&c&&(a.redirectUrl=c,a.type=r.SUCCESS),a})),t=h((({processingResponse:e})=>{const{message:t}=e?.paymentDetails||{},s={type:r.ERROR};return t&&(s.message=t,s.messageContext=o.PAYMENTS),s}));return()=>{e(),t()}}),[r.ERROR,r.SUCCESS,l,h,x,u]),(0,i.jsxs)("div",{className:"p24-payment-container",children:[C.description&&(0,i.jsx)(n,{description:C.description}),C.oneClick.enabled&&(0,i.jsx)(w,{value:R,onChange:_,options:C.oneClick.items}),(0,i.jsx)(m,{className:"p24-blik-code-input",value:x,ref:D,label:f.label.input,feedback:!!N&&(0,i.jsx)(g,{errorMessage:N}),onChange:B,onBlur:B}),C.oneClick.enabled&&(0,i.jsx)("div",{className:"p24-checkbox",children:(0,i.jsx)(p,{disabled:!!R,label:f.label.save,checked:u,onChange:d})}),(0,i.jsxs)("div",{className:"p24-checkbox",children:[(0,i.jsx)(a,{required:!0,label:f.label.regulation,checked:W,onChange:M}),I?(0,i.jsx)(g,{errorMessage:I}):""]}),1===y&&(0,i.jsxs)("div",{className:"p24-waiting",children:[(0,i.jsx)(k,{}),(0,i.jsx)(j,{}),(0,i.jsx)(n,{description:f.confirm.transaction})]})]})};u({name:C.name,label:(0,i.jsx)(l,{label:b,icon:C.icon}),content:(0,i.jsx)(y,{}),edit:(0,i.jsx)(n,{description:C.description}),canMakePayment:()=>!0,ariaLabel:b,placeOrderButtonLabel:f.label.submit,supports:{features:C.supports}})})();