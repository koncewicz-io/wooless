(()=>{"use strict";const e=window.React,t=window.wp.htmlEntities,{i18n:s,data:i}=window.wp,{__}=s,{CheckboxControl:r}=window.wc.blocksCheckout,n=e=>{const{description:s}=e;return(0,t.decodeEntities)(s||"")},a=t=>{let{src:s,name:i=""}=t.icon;return"string"==typeof t.icon&&(s=t.icon),(0,e.createElement)("img",{style:{maxHeight:"20px"},src:s,title:i,alt:i,loading:"lazy"})},c=t=>{const{icons:s,additional:i}=t;return s.length?(0,e.createElement)("span",{style:{display:"flex",flexWrap:"wrap",gap:"6px",fontSize:"65%",alignItems:"center",justifyContent:"flex-end"}},s.map((({src:t,name:s},i)=>(0,e.createElement)(a,{icon:{src:t,name:s},key:i}))),i?(0,e.createElement)("span",{style:{lineHeight:"1.2"}},__("+%d other methods","woocommerce-p24").replace("%d",i)):""):""},l=({required:t=!1,label:s,checked:i,onChange:n,...a})=>(0,e.createElement)(r,{required:t,label:(0,e.createElement)("span",{dangerouslySetInnerHTML:{__html:s}}),checked:i,onChange:n,...a,__nextHasNoMarginBottom:!0});class o{constructor(){this.reset(),this.debug=!1,this.regulation=!1,this.checkout="block"}setError(e){this.error=!0,this.errorMessage=e,this.debug&&console.log("Error:",e)}setCheckout(e){this.checkout=e}hasError(){return this.error}getError(){return this.errorMessage}reset(){this.error=!1,this.errorMessage=null}setRegulation(e){this.regulation=!!e}}const{registerPaymentMethod:u}=window.wc.wcBlocksRegistry,{getSetting:m}=window.wc.wcSettings,{TextInput:h,ValidationInputError:d,CheckboxControl:g}=window.wc.blocksCheckout,{Spinner:p,Button:E}=window.wc.blocksComponents,k=m("p24-blik_data",{}),f=(0,t.decodeEntities)(k.title),C=k?.i18n||{},b=new class extends o{constructor(e){super();const{url:t,refreshTime:s=1e3,totalWaitTime:i=45e3,i18n:r,orderId:n=null,orderKey:a=null,debug:c=!1}=e;this.debug=c,this.url=t,this.refreshTime=s,this.totalWaitTime=i,this.currentWaitingTime=0,this.i18n=r||{},this.orderId=n,this.orderKey=a,this.abort=!0,this.timer=null,this.timeout=null,this.oneClick=!1,this.saveOneClick=!1,this.code=""}setCode(e){this.code=e}format(e){return(e=e.replace(/\D/g,"")).length>=4&&(e=e.replace(/^(.{3})/g,"$1 ")),e.slice(0,7)}setOneClick(e){this.oneClick=e||!1}setSaveOneClick(e){this.saveOneClick=e}codeValidation(e){return 6===(e||this.code).replace(/\D/g,"").length}longPooling(e=!1){this.currentWaitingTime=0,this.forAlias=e;const t=new Promise(((e,t)=>{this.resolve=e,this.reject=t}));return this.abort=!1,this.checkStatus(!0),t}cancelAliasWaiting(){this.resolve&&this.resolve({success:!0})}wait(){return this.timer=this.totalWaitTime/1e3,new Promise((e=>{this.timeout=setTimeout(e,this.refreshTime)}))}async checkStatus(e=!1){const{error:t}=this.i18n;e||(this.currentWaitingTime+=this.refreshTime,this.timer--);const s={type:this.forAlias?"get-alias-status":"get-order-status",checkout:this.checkout};this.orderId&&(s.orderId=this.orderId),this.orderKey&&(s.orderKey=this.orderKey);let i=await fetch(this.url,{method:"POST",body:JSON.stringify(s)});if(200===i.status)try{if(i=await i.json(),i?.data?.completed)this.resolve({success:!0,redirect:i?.data?.redirect});else if(this.currentWaitingTime<this.totalWaitTime){if(this.abort)return;await this.wait(),await this.checkStatus()}else this.currentWaitingTime>=this.totalWaitTime?(this.forAlias?this.resolve({success:!0,redirect:i?.data?.redirect}):this.resolve({error:!0,message:t.timeout}),this.resolve({error:!0,message:t.timeout})):this.resolve({error:!0,message:t.unexpected})}catch(e){this.resolve({error:!0,message:t.unexpected})}else this.reject({error:!0,message:t.unexpected})}cleanup(){const{error:e}=this.i18n;clearTimeout(this.timeout),this.timer=null,this.oneClick=!1,this.saveOneClick=!1,this.code="",this.timeout=null,this.abort=!0,this.resolve&&this.resolve({error:!0,message:e.aborted})}getPaymentData(){let e="code";return this.oneClick&&(e="one-click"),{type:e,regulation:this.regulation,checkout:this.checkout,code:this.code.replace(/\D/g,""),oneClick:!!this.oneClick&&this.oneClick.toString(),save:this.saveOneClick}}}(k),v=()=>{const[t,s]=(0,e.useState)(b.currentWaitingTime);return(0,e.useEffect)((()=>{const e=setInterval((()=>{s(b.currentWaitingTime),b.currentWaitingTime>=b.totalWaitTime&&clearInterval(e)}),1e3);return()=>clearInterval(e)}),[]),(0,e.createElement)("div",null,(0,e.createElement)("strong",null,(0,e.createElement)("big",null,"00:",((b.totalWaitTime-t)/1e3).toString().padStart(2,0))))},y=t=>{const{onChange:s,options:i,value:r}=t;return i.length?(0,e.createElement)("div",{className:"p24-1clicks"},(0,e.createElement)("div",{className:"p24-1clicks__label"},C.use_saved),(0,e.createElement)("div",{className:"p24-1clicks__items"},i.map(((t,i)=>{let n="p24-1click p24-1click--blik";return r===t.id&&(n+=" p24-1click--active"),(0,e.createElement)("button",{key:i,className:n,type:"button",onClick:()=>{return e=t.id,void s(r===e?null:e);var e}},t?.logo&&(0,e.createElement)("figure",{className:"p24-1click__logo p24-1click--blik__logo"},(0,e.createElement)("img",{src:t.logo.url,alt:t.logo.alt})),(0,e.createElement)("span",{className:"p24-1click--blik__name"},t.name),(0,e.createElement)("span",{className:"p24-1click--blik__valid"},t.valid_to))}))),(0,e.createElement)("div",{className:"p24-1clicks__or"},C.or)):""};u({name:k.name,label:(0,e.createElement)((t=>{const{PaymentMethodLabel:s}=t.components,{label:i,icon:r,icons:n,additional:l}=t;return(0,e.createElement)("span",{style:{width:"100%",display:"flex",gap:"12px",justifyContent:"space-between",alignItems:"center"}},(0,e.createElement)(s,{text:i}),n?(0,e.createElement)(c,{icons:n,additional:l}):"",r?(0,e.createElement)(a,{icon:r}):"")}),{label:f,icon:k.icon}),content:(0,e.createElement)((({eventRegistration:t,emitResponse:s})=>{const{responseTypes:i,noticeContexts:r}=s,{onPaymentSetup:a,onCheckoutSuccess:c,onCheckoutFail:o}=t,[u,m]=(0,e.useState)(!1),[f,w]=(0,e.useState)(""),[S,T]=(0,e.useState)(0),[R,_]=(0,e.useState)(!1),[x,N]=(0,e.useState)(!1),[W,O]=(0,e.useState)(""),[P,I,M,D]=function(t,s){const[i,r]=(0,e.useState)(""),[n,a]=(0,e.useState)(!1),[c,l]=(0,e.useState)(!1),[o,u]=(0,e.useState)(!0);return(0,e.useEffect)((()=>{c&&r(o&&!n?s:"")}),[n,o,c]),[n,i,e=>{c||l(!0),t&&t.setRegulation(e),a(e)},(e=!0)=>{let t=!1;return e&&!n?(r(s),t=!1):(e&&n||!e)&&(r(""),t=!0),t},e=>{e||r(""),u(e)}]}(b,C.error.rules),A=(0,e.useRef)(null),j=e=>{e=b.format(e),w(e),b.codeValidation(e)?O(""):O(C.error.validation)};return(0,e.useEffect)((()=>()=>{b.cleanup()}),[]),(0,e.useEffect)((()=>{A?.current?.focus()}),[]),(0,e.useEffect)((()=>{const e=a((()=>{const e={type:i.ERROR};return D()?(O(""),x||b.codeValidation(f)?(e.type=i.SUCCESS,e.meta={paymentMethodData:b.getPaymentData()}):O(C.error.validation),e):e}));return()=>{e()}}),[i.ERROR,i.SUCCESS,a,f,u,R,x,P,I]),(0,e.useEffect)((()=>{b.setCode(f)}),[f]),(0,e.useEffect)((()=>{b.setSaveOneClick(u)}),[u]),(0,e.useEffect)((()=>{b.setOneClick(x),x&&m(!1)}),[x]),(0,e.useEffect)((()=>{R&&b.cancelAliasWaiting()}),[R]),(0,e.useEffect)((()=>{const e=c((async({processingResponse:e})=>{const{error:t,redirect:s}=e?.paymentDetails||{};t||T(1);let{error:n,message:a,success:c}=t?{error:!0,message:t}:await b.longPooling().then((async e=>{const{error:t}=e;return!t&&u?(T(2),await b.longPooling(!0)):e})),l={type:i.ERROR};return n&&(T(0),l.message=a,l.messageContext=r.PAYMENTS),c&&s&&(l.redirectUrl=s,l.type=i.SUCCESS),l})),t=o((({processingResponse:e})=>{const{message:t}=e?.paymentDetails||{},s={type:i.ERROR};return t&&(s.message=t,s.messageContext=r.PAYMENTS),s}));return()=>{e(),t()}}),[i.ERROR,i.SUCCESS,c,o,f,u]),(0,e.createElement)("div",{className:"p24-payment-container"},k.description&&(0,e.createElement)(n,{description:k.description}),k.oneClick.enabled&&(0,e.createElement)(y,{value:x,onChange:N,options:k.oneClick.items}),(0,e.createElement)(h,{className:"p24-blik-code-input",value:f,ref:A,label:C.label.input,feedback:!!W&&(0,e.createElement)(d,{errorMessage:W}),onChange:j,onBlur:j}),k.oneClick.enabled&&(0,e.createElement)("div",{className:"p24-checkbox"},(0,e.createElement)(g,{disabled:!!x,label:C.label.save,checked:u,onChange:m})),(0,e.createElement)("div",{className:"p24-checkbox"},(0,e.createElement)(l,{required:!0,label:C.label.regulation,checked:P,onChange:M}),I?(0,e.createElement)(d,{errorMessage:I}):""),1===S&&(0,e.createElement)("div",{className:"p24-waiting"},(0,e.createElement)(p,null),(0,e.createElement)(v,null),(0,e.createElement)(n,{description:C.confirm.transaction})),2===S&&(0,e.createElement)("div",{className:"p24-waiting"},(0,e.createElement)(p,null),(0,e.createElement)(v,null),(0,e.createElement)(n,{description:C.confirm.alias}),(0,e.createElement)(E,{variant:"contained",onClick:()=>_(!0)},C.label.cancel)))}),null),edit:(0,e.createElement)(n,{description:k.description}),canMakePayment:()=>!0,ariaLabel:f,placeOrderButtonLabel:C.label.submit,supports:{features:k.supports}})})();